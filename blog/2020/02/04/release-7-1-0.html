<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>bs-platform release 7.1.0 · BuckleScript</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta name="description" content="`bs-platform@7.1.0` is a major release. You can try it with `npm i -g bs-platform`!"/><meta name="docsearch:language" content="en"/><meta property="og:title" content="bs-platform release 7.1.0 · BuckleScript"/><meta property="og:type" content="website"/><meta property="og:url" content="https://bucklescript.github.io/blog/2020/02/04/release-7-1-0"/><meta property="og:description" content="`bs-platform@7.1.0` is a major release. You can try it with `npm i -g bs-platform`!"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/logos/bucklescript.png"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/atom-one-light.min.css"/><link rel="alternate" type="application/atom+xml" href="https://bucklescript.github.io/blog/atom.xml" title="BuckleScript Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://bucklescript.github.io/blog/feed.xml" title="BuckleScript Blog RSS Feed"/><script type="text/javascript" src="/js/toggleSyntaxButton.js"></script><script type="text/javascript" src="/js/redirectToNewDoc.js"></script><script type="text/javascript" src="/js/pjax-api.min.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/en"><img class="logo" src="/img/logos/bucklescript.svg" alt="BuckleScript"/><h2 class="headerTitleWithLogo">BuckleScript</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class=""><a href="/docs/en/installation" target="_self">Docs</a></li><li class=""><a href="/docs/en/playground" target="_self">Try</a></li><li class=""><a href="/docs/en/stdlib-overview" target="_self">API</a></li><li class=""><a href="/docs/en/community" target="_self">Community</a></li><li class="siteNavGroupActive"><a href="/blog/" target="_self">Blog</a></li><span><li><a id="languages-menu" href="#"><img class="languages-icon" src="/img/language.svg" alt="Languages icon"/>English</a><div id="languages-dropdown" class="hide"><ul id="languages-dropdown-items"><li><a href="/ja">日本語</a></li><li><a href="/es-ES">Español</a></li><li><a href="/fr">Français</a></li><li><a href="/ko">한국어</a></li><li><a href="/pt-BR">Português (Brasil)</a></li><li><a href="/ru">Русский</a></li><li><a href="/zh-CN">中文</a></li><li><a href="/zh-TW">繁體中文</a></li><li><a href="https://crowdin.com/project/bucklescript" target="_blank" rel="noreferrer noopener">Help Translate</a></li></ul></div></li><script>
        const languagesMenuItem = document.getElementById("languages-menu");
        const languagesDropDown = document.getElementById("languages-dropdown");
        languagesMenuItem.addEventListener("click", function(event) {
          event.preventDefault();

          if (languagesDropDown.className == "hide") {
            languagesDropDown.className = "visible";
          } else {
            languagesDropDown.className = "hide";
          }
        });
      </script></span><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li><li class=""><a href="https://github.com/bucklescript/bucklescript" target="_self">GitHub</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Recent Posts</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Recent Posts</h3><ul class=""><li class="navListItem"><a class="navItem" href="/blog/2020/05/06/exception-encoding">A story of exception encoding in BuckleScript</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/04/13/release-7-3">What&#x27;s new in release 7.3</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/03/26/generalize-uncurry">Generalized uncurry support in BuckleScript 7.3</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/03/12/release-7-2">Announcing bs-platform  7.2</a></li><li class="navListItem"><a class="navItem" href="/blog/2020/02/20/loading-stdlib-in-memory">Loading stdlib from memory</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer postContainer blogContainer"><div class="wrapper"><div class="lonePost"><div class="post"><header class="postHeader"><h1 class="postHeaderTitle"><a href="/blog/2020/02/04/release-7-1-0">bs-platform release 7.1.0</a></h1><p class="post-meta">February 4, 2020</p><div class="authorBlock"></div></header><div><span><p><code>bs-platform@7.1.0</code> is a major release. You can try it with <code>npm i -g bs-platform</code>!
(If you have permission issues, try <code>sudo npm i --unsafe-perm -g bs-platform</code>)</p>
<p>It was called 7.0.2 but bumped into 7.1.0 due to a soundness fix (a breaking change) as follows:</p>
<p>Previously, the empty array <code>[||]</code> was polymorphic. This happens to be true, since in native an array is not resizable, so users cannot do anything with it. But in JS, we introduced a binding for <code>push</code> which can change the size of an array dynamically. In this case, an empty array cannot be polymorphic any more.</p>
<p>Removing <code>push</code> is possible, but it makes arrays in JS context less useful. To fix this issue while keeping <code>push</code>, we make <code>[||]</code> weakly typed so that its type inference is deferred until the first time it is used. If it is never used across the module, it has to be annotated with a concrete type; otherwise, the type checker will complain.</p>
<p>Several highlighted features are listed as follows:</p>
<h2><a class="anchor" aria-hidden="true" id="raw-javascript-parsing-checking"></a><a href="#raw-javascript-parsing-checking" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Raw JavaScript Parsing/Checking</h2>
<p>BuckleScript allows users to embed raw JavaScript code as an escape hatch; it used to treat such piece of code as a black box.</p>
<p>In this release we vendor a JavaScript parser (thanks to <a href="https://github.com/facebook/flow">flowtype</a>) for syntax checking and simple semantics analysis over <code>raw</code>. This is on-going work, but it is already useful now.</p>
<p>First, we now report syntax errors properly for <code>raw</code>.</p>
<p>Second, for simple semantics analysis, we can tell whether the code inside raw is a function or not and the arity of raw function:</p>
<pre><code class="hljs css language-ocaml"><span class="hljs-keyword">let</span> f = [%raw <span class="hljs-string">"function(x){return x}"</span>]
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">let</span> f = <span class="hljs-attribute">[%raw "function(x){return x}"]</span>;
</code></pre>
<p>Now we know <code>f</code> is a function declaration with no side effect; it can be removed by the dead code analyzer if not used. We also know its arity so that when it's called we know whether it's fully applied or not.</p>
<p>Because this sort of information can be derived from <code>raw</code> directly, the special <code>raw</code> form we introduced as follows is no longer needed:</p>
<pre><code class="hljs css language-ocaml"><span class="hljs-keyword">let</span> f = <span class="hljs-keyword">fun</span>%raw x -&gt; {|x|}
</code></pre>
<pre><code class="hljs css language-reason"><span class="hljs-keyword">let</span> f = <span class="hljs-attribute">[%raw x =&gt; {|x|}]</span>;
</code></pre>
<p>To reduce interop API surface, this feature will now be discouraged.</p>
<p>We're also exploring using such knowledge on JS literals and regexes checking.</p>
<h2><a class="anchor" aria-hidden="true" id="unboxed-types"></a><a href="#unboxed-types" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Unboxed Types</h2>
<p>One major feature introduced in this release is <strong>unboxed types</strong> which is blogged <a href="https://bucklescript.github.io/blog/2019/12/20/release-7-02">here</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="uniform-warning-system"></a><a href="#uniform-warning-system" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Uniform Warning System</h2>
<p>Previously warnings are reported in two ways:</p>
<ul>
<li>The OCaml compiler style: <code>-w +10</code></li>
<li>Ad-hoc warnings introduced by flags <code>-bs-warn-unimplemented-external</code></li>
</ul>
<p>In this release, we  make such integration so that BuckleScript warnings are handled in the same way as OCaml's own warnings, for example, the warning attribute below can also turn off  BuckleScript warnings now.</p>
<pre><code class="hljs css language-reason"><span class="hljs-attribute">[@warning "-101"]</span>; <span class="hljs-operator">/</span><span class="hljs-operator">/</span> file<span class="hljs-operator">-</span>level config
</code></pre>
<p>Based on this effort, we have changed all BuckleScript warnings into OCaml style warnings to reduce user-level complexity.</p>
<p>The newly introduced warnings are listed via <code>bsc -warn-help</code>:</p>
<pre><code class="hljs"><span class="hljs-symbol">101 </span>BuckleScript warning: Unused bs attributes
<span class="hljs-symbol">102 </span>BuckleScript warning: polymorphic comparison introduced (maybe unsafe)
<span class="hljs-symbol">103 </span>BuckleScript warning: about fragile FFI definitions
<span class="hljs-symbol">104 </span>BuckleScript warning: bs.deriving warning with customized message
<span class="hljs-symbol">105 </span>BuckleScript warning: the external <span class="hljs-keyword">name</span> is inferred from <span class="hljs-keyword">val</span> <span class="hljs-keyword">name</span> is unsafe from refactoring when changing value <span class="hljs-keyword">name</span>
<span class="hljs-symbol">106 </span>BuckleScript warning: Unimplemented primitive used:
<span class="hljs-symbol">107 </span>BuckleScript warning: Integer literal exceeds the range of representable integers of type <span class="hljs-keyword">int</span>
<span class="hljs-symbol">108 </span>BuckleScript warning: Uninterpreted delimiters (<span class="hljs-keyword">for</span> unicode)
</code></pre>
<p>We also recommend users to turn on <code>warnerror</code> and only disable warnings for some specific files.</p>
<p>We've also upgraded the Reason parser <code>refmt</code> to 3.6.0.</p>
<p>A full list of changes is available here: <a href="https://github.com/BuckleScript/bucklescript/blob/master/Changes.md#702">https://github.com/BuckleScript/bucklescript/blob/master/Changes.md#702</a></p>
</span></div></div><div class="blogSocialSection"></div></div><div class="blog-recent"><a class="button" href="/blog">Recent Posts</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#raw-javascript-parsing-checking">Raw JavaScript Parsing/Checking</a></li><li><a href="#unboxed-types">Unboxed Types</a></li><li><a href="#uniform-warning-system">Uniform Warning System</a></li></ul></nav></div><span></span></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: '0fd97db83891aa20810559812d9e69ac',
                indexName: 'bucklescript',
                inputSelector: '#search_input_react',
                algoliaOptions: {"facetFilters":["lang:en"]}
              });
            </script></body></html>